rules_version = '2'; service cloud.firestore { match /databases/{database}/documents { function isSignedIn() { return request.auth != null; } function isOwner(userId) { return isSignedIn() && request.auth.uid == userId; }
match /users/{userId} {
  match /items/{itemId} {
    allow read: if isOwner(userId);
    allow create: if isOwner(userId)
                  && request.resource.data.userId == userId;
    allow update: if isOwner(userId)
                  && request.resource.data.userId == userId;
    allow delete: if isOwner(userId);

    match /logs/{logId} {
      allow read: if isOwner(userId);
      allow create: if isOwner(userId)
                    && request.resource.data.userId == userId
                    && request.resource.data.itemId == itemId;
      allow update: if isOwner(userId)
                    && request.resource.data.userId == userId
                    && request.resource.data.itemId == itemId;
      allow delete: if isOwner(userId);
    }
  }
}
} }